C51 COMPILER V9.54   RS485                                                                 07/03/2024 22:51:09 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE RS485
OBJECT MODULE PLACED IN .\Objects\rs485.obj
COMPILER INVOKED BY: D:\App\Keil_v5\C51\BIN\C51.EXE UART\rs485.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\rs485.lst) TABS(2) OBJECT(.\Objects\rs485.obj)

line level    source

   1          /**************************************************************************************
   2          *                 RS485通信实验                         *
   3          实现现象：下载程序后打开串口调试助手，将波特率设置为4800，选择发送的数据就可以显示
   4                在串口助手上。具体接线操作参考操作视频
   5          注意事项：无。
   6          ***************************************************************************************/
   7          
   8          #include "reg52.h" //此文件中定义了单片机的一些特殊功能寄存器
   9          
  10          typedef unsigned int u16; // 对数据类型进行声明定义
  11          typedef unsigned char u8;
  12          
  13          sbit RS485DIR = P1 ^ 0; // 方向控制: RS485DIR=0为接收状态  RS485DIR=1为发送状态
  14          
  15          /*******************************************************************************
  16           * 函 数 名         : delay
  17           * 函数功能      : 延时函数，i=1时，大约延时10us
  18           *******************************************************************************/
  19          void delay(u16 i)
  20          {
  21   1        while (i--)
  22   1          ;
  23   1      }
  24          
  25          /*******************************************************************************
  26           * 函数名         :UsartInit()
  27           * 函数功能      :设置串口
  28           * 输入           : 无
  29           * 输出            : 无
  30           *******************************************************************************/
  31          void UsartInit()
  32          {
  33   1        SCON = 0X50; // 设置为工作方式1
  34   1        TMOD = 0X20; // 设置计数器工作方式2
  35   1        PCON = 0X80; // 波特率加倍
  36   1        TH1 = 0XF3;  // 计数器初始值设置，注意波特率是4800的
  37   1        TL1 = 0XF3;
  38   1        ES = 1;  // 打开接收中断
  39   1        EA = 1;  // 打开总中断
  40   1        TR1 = 1; // 打开计数器
  41   1        RS485DIR = 0;
  42   1      }
  43          
  44          /*******************************************************************************
  45           * 函 数 名       : main
  46           * 函数功能    : 主函数
  47           * 输    入       : 无
  48           * 输    出      : 无
  49           *******************************************************************************/
  50          void main()
  51          {
  52   1        UsartInit(); // 串口初始化
  53   1        while (1)
  54   1          ;
C51 COMPILER V9.54   RS485                                                                 07/03/2024 22:51:09 PAGE 2   

  55   1      }
  56          
  57          /*******************************************************************************
  58           * 函数名         : Usart() interrupt 4
  59           * 函数功能     : 串口通信中断函数
  60           * 输入           : 无
  61           * 输出            : 无
  62           *******************************************************************************/
  63          void Usart() interrupt 4
  64          {
  65   1        u8 receiveData;
  66   1      
  67   1        receiveData = SBUF; // 出去接收到的数据
  68   1        RI = 0;       // 清除接收中断标志位
  69   1        delay(100);
  70   1        RS485DIR = 1;   // 置位 发送
  71   1        SBUF = receiveData; // 将接收到的数据放入到发送寄存器
  72   1        while (!TI)
  73   1          ;     // 等待发送数据完成
  74   1        TI = 0;     // 清除发送完成标志位
  75   1        RS485DIR = 0; // 复位 接收
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     92    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
