C51 COMPILER V9.54   KEYMATRIX                                                             06/03/2024 10:36:15 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEYMATRIX
OBJECT MODULE PLACED IN .\Objects\KeyMatrix.obj
COMPILER INVOKED BY: D:\App\Keil_v5\C51\BIN\C51.EXE Keyboard\KeyMatrix.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTE
                    -ND PRINT(.\Listings\KeyMatrix.lst) TABS(2) OBJECT(.\Objects\KeyMatrix.obj)

line level    source

   1          /**************************************************************************************
   2          *                 çŸ©é˜µæŒ‰é”®å®éªŒ                          *
   3          å®ç°ç°è±¡ï¼šä¸‹è½½ç¨‹åºåæ•°ç ç®¡æ˜¾ç¤º0ï¼ŒæŒ‰ä¸‹çŸ©é˜µæŒ‰é”®ä¸Šçš„æŒ‰é”®æ˜¾ç¤ºå¯¹åº”çš„æ•°å­—
   4                      S1-S4ï¼š0-3
   5                      S5-S8ï¼š4-7
   6                      S9-S12ï¼š8-B
   7                      S13-S16ï¼šC-Fã€‚
   8          æ³¨æ„äº‹é¡¹ï¼š
   9          ***************************************************************************************/
  10          
  11          #include "reg52.h" //æ­¤æ–‡ä»¶ä¸­å®šä¹‰äº†å•ç‰‡æœºçš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨
  12          #include "KeyMatrix.h"
  13          #include "../Utility/delay.h"
  14          #include "../Utility/CommData.h"
  15          
  16          typedef unsigned int u16; // å¯¹æ•°æ®ç±»å‹è¿›è¡Œå£°æ˜å®šä¹‰
  17          typedef unsigned char u8;
  18          
  19          #define GPIO_DIG P0 // P0^7_P0^0 - ~ ABCDEFG
  20          #define GPIO_KEY P1 // P1^7_P1^0 - C0C1C2C3K0K1K2K3
  21          
  22          /*******************************************************************************
  23           è¡Œåˆ—æ‰«ææŒ‰é”®
  24           è¡Œï¼šé«˜4ä½ åˆ—ï¼šä½4ä½
  25           é«˜4ä½ä¸º0ï¼Œä½4ä½ä¸º1 0x0F(0b00001111) -> é«˜4ä½ä¸º1ï¼Œä½4ä½ä¸º0 0xF0(0b11110000)
  26           *******************************************************************************/
  27          int CheckKeyDown()
  28          {
  29   1          char a = 0;
  30   1          int Key = -1; // ç”¨æ¥å­˜æ”¾è¯»å–åˆ°çš„é”®å€¼
  31   1          GPIO_KEY = 0x0F;
  32   1          if (GPIO_KEY != 0x0F) // è¯»å–æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  33   1          {
  34   2              delay_ms(10);         // å»¶æ—¶10msè¿›è¡Œæ¶ˆæŠ–
  35   2              if (GPIO_KEY != 0x0f) // å†æ¬¡æ£€æµ‹é”®ç›˜æ˜¯å¦æŒ‰ä¸‹
  36   2              {
  37   3                  // ç¡®å®šæŒ‰é”®æ‰€åœ¨åˆ—
  38   3                  // GPIO_KEY = 0X0F;
  39   3                  switch (GPIO_KEY)
  40   3                  {
  41   4                  case (0X07):
  42   4                      Key = 0;
  43   4                      break;
  44   4                  case (0X0b):
  45   4                      Key = 1;
  46   4                      break;
  47   4                  case (0X0d):
  48   4                      Key = 2;
  49   4                      break;
  50   4                  case (0X0e):
  51   4                      Key = 3;
  52   4                      break;
  53   4                  }
  54   3                  // ç¡®å®šæŒ‰é”®æ‰€åœ¨åˆ—è¡Œ
C51 COMPILER V9.54   KEYMATRIX                                                             06/03/2024 10:36:15 PAGE 2   

  55   3                  GPIO_KEY = 0XF0;
  56   3                  switch (GPIO_KEY)
  57   3                  {
  58   4                  case (0X70):
  59   4                      Key = Key;
  60   4                      break;
  61   4                  case (0Xb0):
  62   4                      Key = Key + 4;
  63   4                      break;
  64   4                  case (0Xd0):
  65   4                      Key = Key + 8;
  66   4                      break;
  67   4                  case (0Xe0):
  68   4                      Key = Key + 12;
  69   4                      break;
  70   4                  }
  71   3                  // æ£€æµ‹æŒ‰é”®æ¾æ‰‹æ£€æµ‹
  72   3                  // while ((a < 50) && (GPIO_KEY != 0XF0))
  73   3                  // {
  74   3                  //     delay_ms(10);
  75   3                  //     a++; // å¦‚æœæŒ‰é”®ä¸€ç›´æŒ‰ä¸‹ï¼Œè¶…è¿‡ 50*10msï¼Œå°±å¼ºåˆ¶é€€å‡ºï¼Œä¿è¯ç¨‹åºç»§ç»
             -­æ‰§è¡Œ
  76   3                  // }
  77   3              }
  78   2          }
  79   1          return Key;
  80   1      }
  81          
  82          void TestKeyMatrix()
  83          {
  84   1      
  85   1          while (1)
  86   1          {
  87   2              unsigned char Key = CheckKeyDown();
  88   2              GPIO_DIG = ~smgduan[Key];
  89   2          }
  90   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    190    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
