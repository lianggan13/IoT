C51 COMPILER V9.54   KEYMATRIX                                                             05/25/2024 22:21:27 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEYMATRIX
OBJECT MODULE PLACED IN .\Objects\KeyMatrix.obj
COMPILER INVOKED BY: D:\App\Keil_v5\C51\BIN\C51.EXE Keyboard\KeyMatrix.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\KeyMatrix.lst) TABS(2) OBJECT(.\Objects\KeyMatrix.obj)

line level    source

   1          /**************************************************************************************
   2          *                 çŸ©é˜µæŒ‰é”®å®éªŒ                          *
   3          å®ç°ç°è±¡ï¼šä¸‹è½½ç¨‹åºåæ•°ç ç®¡æ˜¾ç¤º0ï¼ŒæŒ‰ä¸‹çŸ©é˜µæŒ‰é”®ä¸Šçš„æŒ‰é”®æ˜¾ç¤ºå¯¹åº”çš„æ•°å­—
   4                      S1-S4ï¼š0-3
   5                      S5-S8ï¼š4-7
   6                      S9-S12ï¼š8-B
   7                      S13-S16ï¼šC-Fã€‚
   8          æ³¨æ„äº‹é¡¹ï¼š
   9          ***************************************************************************************/
  10          
  11          #include "reg52.h" //æ­¤æ–‡ä»¶ä¸­å®šä¹‰äº†å•ç‰‡æœºçš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨
  12          #include "KeyMatrix.h"
  13          #include "../Utility/delay.h"
  14          
  15          typedef unsigned int u16; // å¯¹æ•°æ®ç±»å‹è¿›è¡Œå£°æ˜å®šä¹‰
  16          typedef unsigned char u8;
  17          
  18          #define GPIO_DIG P0 // P0^7_P0^0 - ~ ABCDEFG
  19          #define GPIO_KEY P1 // P1^7_P1^0 - C0C1C2C3K0K1K2K3
  20          
  21          u8 code smgduan[17] = {0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07,
  22                                 0x7f, 0x6f, 0x77, 0x7c, 0x39, 0x5e, 0x79, 0x71}; // æ˜¾ç¤º0~Fçš„å€¼
  23          
  24          /*******************************************************************************
  25           è¡Œåˆ—æ‰«ææŒ‰é”®
  26           è¡Œï¼šé«˜4ä½ åˆ—ï¼šä½4ä½
  27           é«˜4ä½ä¸º0ï¼Œä½4ä½ä¸º1 0x0F(0b00001111) -> é«˜4ä½ä¸º1ï¼Œä½4ä½ä¸º0 0xF0(0b11110000)
  28           *******************************************************************************/
  29          int CheckKeyDown()
  30          {
  31   1          char a = 0;
  32   1          int Key = -1; // ç”¨æ¥å­˜æ”¾è¯»å–åˆ°çš„é”®å€¼
  33   1          GPIO_KEY = 0x0F;
  34   1          if (GPIO_KEY != 0x0F) // è¯»å–æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  35   1          {
  36   2              delay_ms(10);         // å»¶æ—¶10msè¿›è¡Œæ¶ˆæŠ–
  37   2              if (GPIO_KEY != 0x0f) // å†æ¬¡æ£€æµ‹é”®ç›˜æ˜¯å¦æŒ‰ä¸‹
  38   2              {
  39   3                  // ç¡®å®šæŒ‰é”®æ‰€åœ¨åˆ—
  40   3                  // GPIO_KEY = 0X0F;
  41   3                  switch (GPIO_KEY)
  42   3                  {
  43   4                  case (0X07):
  44   4                      Key = 0;
  45   4                      break;
  46   4                  case (0X0b):
  47   4                      Key = 1;
  48   4                      break;
  49   4                  case (0X0d):
  50   4                      Key = 2;
  51   4                      break;
  52   4                  case (0X0e):
  53   4                      Key = 3;
  54   4                      break;
C51 COMPILER V9.54   KEYMATRIX                                                             05/25/2024 22:21:27 PAGE 2   

  55   4                  }
  56   3                  // ç¡®å®šæŒ‰é”®æ‰€åœ¨åˆ—è¡Œ
  57   3                  GPIO_KEY = 0XF0;
  58   3                  switch (GPIO_KEY)
  59   3                  {
  60   4                  case (0X70):
  61   4                      Key = Key;
  62   4                      break;
  63   4                  case (0Xb0):
  64   4                      Key = Key + 4;
  65   4                      break;
  66   4                  case (0Xd0):
  67   4                      Key = Key + 8;
  68   4                      break;
  69   4                  case (0Xe0):
  70   4                      Key = Key + 12;
  71   4                      break;
  72   4                  }
  73   3                  // æ£€æµ‹æŒ‰é”®æ¾æ‰‹æ£€æµ‹
  74   3                  // while ((a < 50) && (GPIO_KEY != 0XF0))
  75   3                  // {
  76   3                  //     delay_ms(10);
  77   3                  //     a++; // å¦‚æœæŒ‰é”®ä¸€ç›´æŒ‰ä¸‹ï¼Œè¶…è¿‡ 50*10msï¼Œå°±å¼ºåˆ¶é€€å‡ºï¼Œä¿è¯ç¨‹åºç»§ç»
             -­æ‰§è¡Œ
  78   3                  // }
  79   3              }
  80   2          }
  81   1          return Key;
  82   1      }
  83          
  84          void TestKeyMatrix()
  85          {
  86   1      
  87   1          while (1)
  88   1          {
  89   2              unsigned char Key = CheckKeyDown();
  90   2              GPIO_DIG = ~smgduan[Key];
  91   2          }
  92   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    145    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
